<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>åä¸œå¸ˆèŒƒå¤§å­¦è¯¾é¢˜ç»„</title>
<style type="text/css">
        .border {width:820px; height:150px; margin:50px auto;}
        .luyin {float:left;width:380px; border:1px dashed black;padding:20px;}
        .search {float:right;width:320px; height:410px;border:1px dashed black;padding:20px;}
        .search_noborder {float:right;width:320px; padding:20px;}
        .res-img {width: 250px;height: 250px;margin: 20px 0px;}
        a {
            text-decoration:none;
            color:black;
        }
        button {
            background-color:lightsalmon;
        }
</style>
</head>
<body>
    <div class="border">
    {% load staticfiles %}
        <div class="luyin">
                <div style="width:380px; height:400px; margin:1px auto;background: rgb(220,220,220);">
                    <div style="font-size:20px; font-weight:200;position: relative;top:200px;left: 80px;">
                    æ˜¾ç¤ºä»»åŠ¡äºŒçš„æƒ…å¢ƒææ–™
                    </div>
                </div>
                <div style="width:380px; height:50px; margin:1px auto;background:rgb(192,192,192);font-size:20px; font-weight:200;">
                    <div style="font-size:20px; font-weight:200;position: relative;top:10px;left: 80px;">
                    æ˜¾ç¤ºä»»åŠ¡äºŒçš„è¦æ±‚
                    </div>    
                </div>
                <button id="recBtn" onclick="recordControll()">å¼€å§‹å½•éŸ³</button>
                <button type="button"><a href="/nine/">ä¸‹ä¸€æ­¥</a></button>
        </div>
        <div class="search">
            <div class="res-word">
                <p>&emsp;&emsp;åœ¨ä¸‹é¢â€œèµ„æ–™æœç´¢â€æ¡†ä¸­è¾“å…¥å…³é”®è¯â€œåœ°çƒâ€ï¼Œç„¶åç‚¹å‡»ğŸ”ï¼ŒæŸ¥åˆ°çš„èµ„æ–™å°±ä¼šæ˜¾ç¤ºåœ¨å½“å‰è¿™ä¸ªæ¡†å†…ã€‚</p>
                <p>&emsp;&emsp;åœ¨æ­£å¼æµ‹è¯•æ—¶ï¼Œå¦‚æœæœç´¢ä¸åˆ°ä¿¡æ¯ï¼Œè¯·ä¸¾æ‰‹å’¨è¯¢è€å¸ˆã€‚</p>
                <p>&emsp;&emsp;æœç´¢ä½“éªŒç»“æŸåï¼Œè¯·ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ã€‚</p>
            </div>
            <img src="" class="res-img">
        </div>
        <div class="search_noborder">
            <span>èµ„æ–™æœç´¢ï¼š</span>
            <input type="text" name="searchKey" id="searchKey">
            <button id="searchBtn">ğŸ”</button>
            
            
        </div>
    </div>

    <!-- jQuery -->
    <script src="{% static 'js\jquery-1.11.0.js' %}" type="text/javascript" charset="utf-8"></script>

    <script>
        $(document).ready(function(){
            $(".res-img").hide(); // éšè—å›¾ç‰‡å…ƒç´ 
            $("#searchBtn").click(function(){
                var key = $("#searchKey").val();
                if(key=="") {
                    alert("è¾“å…¥å†…å®¹ä¸ºç©º");
                } else {
                    $.ajax({
                        url : "/search/",//è¯·æ±‚åœ°å€
                        type : "GET",//è¯·æ±‚æ–¹å¼
                        contentType: "application/json;charset=UTF-8",//è¯·æ±‚çš„åª’ä½“ç±»å‹
                        data : {"key":key},
                        success : function(result) {//è¯·æ±‚æˆåŠŸ   
                            console.log(result);
                            console.log(result["imgPath"]);
                            console.log(result["content"]);
                            var img_path = result["imgPath"];
                            $(".res-word").html(result["content"]);
                            $(".res-img").attr('src',img_path);//è®¾ç½®å›¾ç‰‡è·¯å¾„
                            if(img_path){
                                $(".res-img").show();//æ˜¾ç¤ºå›¾ç‰‡
                            }
                            
                        },
                        error : function(e){//è¯·æ±‚å¤±è´¥ï¼ŒåŒ…å«å…·ä½“çš„é”™è¯¯ä¿¡æ¯
                            console.log(e.status);
                            console.log(e.responseText);
                        }
                    });
                }
                
            });
        });
    </script>

<!-- å½•éŸ³æ’ä»¶ -->
<script src="{% static 'Recorder-master/recorder.mp3.min.js' %}" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
    
    var recordFlag = 0; // 0å‡†å¤‡å½•éŸ³ï¼Œ1å½•éŸ³ä¸­ï¼Œ2å½•éŸ³å®Œæ¯•
    function recordControll(){
        if(recordFlag == 0) {
            document.getElementById("recBtn").innerHTML = "åœæ­¢å½•éŸ³";
            document.getElementById("recBtn").style.background=' lightskyblue';
            //document.getElementById("recBtn").style.color='white';
            beginRecord();
            recordFlag = 1;
        } else if(recordFlag == 1) {
            endRecord();
            recordFlag = 2;
            //window.location.href="/task1/"
        } 
    }

    // åˆå§‹åŒ–Recorder
    var rec=Recorder({type:"mp3",sampleRate:16000});
    function beginRecord() {
        rec.open(function(){
        //startæ‰“å¼€å½•éŸ³
Â Â Â Â Â Â Â Â     rec.start();
Â Â Â Â Â Â Â Â },function(msg){
Â Â Â Â Â Â Â Â     mui.toast("æ— æ³•å½•éŸ³:"+msg);
Â Â Â Â Â Â Â Â });
    }
    
    function endRecord() {
        rec.stop(function(blob,duration){
Â Â Â Â Â Â Â Â     //var res=URL.createObjectURL(blob);
Â Â Â Â Â Â Â Â     console.log((window.URL||webkitURL).createObjectURL(blob),"æ—¶é•¿:"+duration+"ms");
            rec.close();//é‡Šæ”¾å½•éŸ³èµ„æº
            //å·²ç»æ‹¿åˆ°blobæ–‡ä»¶å¯¹è±¡æƒ³å¹²å˜›å°±å¹²å˜›ï¼šç«‹å³æ’­æ”¾ã€ä¸Šä¼ 

            var form=new FormData();
            form.append("upfile",blob,"Eight.mp3"); //å’Œæ™®é€šformè¡¨å•å¹¶æ— äºŒè‡´ï¼Œåç«¯æ¥æ”¶åˆ°upfileå‚æ•°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºrecorder.mp3
            console.log(form);
            // å­˜å‚¨åˆ°æœåŠ¡å™¨
            $.ajax({
                url:'/uploadEight/',
                type:'post',
                contentType:false, //è®©xhrè‡ªåŠ¨å¤„ç†Content-Type headerï¼Œmultipart/form-dataéœ€è¦ç”Ÿæˆéšæœºçš„boundary
                processData:false, //ä¸è¦å¤„ç†dataï¼Œè®©xhrè‡ªåŠ¨å¤„ç†
                data:form,
                success:function(v){
                    console.log("ä¸Šä¼ æˆåŠŸ",v);
                },
                error:function(s){
                    console.error("ä¸Šä¼ å¤±è´¥",s);
                }
            });

            /*ç«‹å³æ’­æ”¾ä¾‹å­*/
            /*
            var audio=document.createElement("audio");
            audio.controls=true;
            document.body.appendChild(audio);
            audio.src=(window.URL||webkitURL).createObjectURL(blob);
            audio.play();
            */
Â Â Â Â Â Â Â Â });
    }
</script>
</body>
</html>
